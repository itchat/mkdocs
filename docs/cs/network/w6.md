# Network Layer Practice Questions

## Question 1: IP Packet Header

A host computer (Host A) sends an email to another host (Host B). The email application uses TCP as its transport protocol.

a)  When an IP packet carrying a segment of this email data is created on Host A, what value would typically be found in the "Protocol" field of the IPv4 header? Explain why.

- **Answer**: The "Protocol" field would typically contain the value `6`. This is because the value `6` is the standard protocol number assigned to TCP (Transmission Control Protocol). The IP layer uses this field to know which upper-layer protocol (in this case, TCP) should receive the payload of the IP datagram once it reaches the destination host.
- **Knowledge Point**: IPv4 Header - Protocol field; Role of Protocol field in demultiplexing to upper layers (TCP, UDP, ICMP, etc.).

b)  Explain the purpose of the "Time To Live (TTL)" field in the IPv4 header of this packet. What is a likely consequence if the TTL value decrements to zero before the packet reaches Host B?

- **Answer**: The "Time To Live (TTL)" field is an 8-bit field that indicates the maximum number of hops (routers) an IP datagram is allowed to traverse in the network. Each router that forwards the packet decrements the TTL value by at least one.
If the TTL value decrements to zero before the packet reaches Host B, the router that decremented it to zero will discard the packet. This router typically sends an ICMP "Time Exceeded" message back to the source (Host A). The primary purpose of TTL is to prevent packets from circulating endlessly in the network in case of routing loops.
- **Knowledge Point**: IPv4 Header - TTL field; Purpose of TTL (preventing indefinite packet circulation, loop prevention); ICMP Time Exceeded message.

c)  If the total IP datagram size is 1000 bytes and the IP header is 20 bytes long, what value would be in the "Total Length" field of the IPv4 header?

- **Answer**: The "Total Length" field would contain the value `1000`. This field specifies the total length of the IP datagram in bytes, including both the header and the data.
- **Knowledge Point**: IPv4 Header - Total Length field; Includes header and data.

---

## Question 2: IPv4 Fragmentation

An IP datagram has a total size of 4500 bytes (this includes a standard 20-byte IPv4 header, so the payload is 4480 bytes). This datagram needs to be transmitted from a source host to a destination host across a network path. One of the links in this path has a Maximum Transmission Unit (MTU) of 1500 bytes.

a)  Is fragmentation necessary for this datagram to traverse the link with an MTU of 1500 bytes? Explain your reasoning.

- **Answer**: Yes, fragmentation is necessary. The datagram size (4500 bytes) is larger than the MTU of the link (1500 bytes). An IP datagram cannot be larger than the MTU of the underlying network link it needs to traverse.
- **Knowledge Point**: MTU (Maximum Transmission Unit); Condition for fragmentation (Datagram Size > MTU).

b)  If fragmentation is necessary, describe how the original datagram would be fragmented. For each fragment, specify the values for the following IPv4 header fields:

- Total Length
- Identification
- More Fragments (MF) flag
- Fragment Offset
(Assume the original datagram has an Identification value of 777. The IP header size is 20 bytes.)

- **Answer**:
    The maximum data payload per fragment over the 1500-byte MTU link is `1500 - 20` (IP header) `= 1480` bytes. The fragment offsets are measured in 8-byte blocks.

    - **Fragment 1**:
        - Total Length: `1500` bytes (1480 bytes data + 20 bytes header)
        - Identification: `777` (same for all fragments of the original datagram)
        - More Fragments (MF) flag: `1` (indicates this is not the last fragment)
        - Fragment Offset: `0` (this fragment contains the first part of the data, offset `0 * 8 = 0` bytes)
        - Data: Bytes 0-1479 of the original payload.

    - **Fragment 2**:
        - Total Length: `1500` bytes (1480 bytes data + 20 bytes header)
        - Identification: `777`
        - More Fragments (MF) flag: `1`
        - Fragment Offset: `185` (since `1480 bytes / 8 bytes per unit = 185`. This fragment starts after the first 1480 bytes of data)
        - Data: Bytes 1480-2959 of the original payload.

    - **Fragment 3**:
        - Remaining data: `4480` (original payload) - `1480` (Frag 1) - `1480` (Frag 2) = `1520` bytes. This is still too large.
        - Total Length: `1500` bytes (1480 bytes data + 20 bytes header)
        - Identification: `777`
        - More Fragments (MF) flag: `1`
        - Fragment Offset: `370` (185 + 185, or `2960 / 8`)
        - Data: Bytes 2960-4439 of the original payload.

    - **Fragment 4**:
        - Remaining data: `1520` (from previous step) - `1480` (Frag 3) = `40` bytes.
        - Total Length: `40` (data) + `20` (header) = `60` bytes
        - Identification: `777`
        - More Fragments (MF) flag: `0` (this is the last fragment)
        - Fragment Offset: `555` (370 + 185, or `4440 / 8`)
        - Data: Bytes 4440-4479 of the original payload.

    *(Correction in calculation for Fragment 3 & 4 based on original payload of 4480 bytes)*
    Original payload = 4480 bytes.
    Fragment 1 data: 1480 bytes (bytes 0-1479). Offset 0. MF=1. Total Length = 1500.
    Fragment 2 data: 1480 bytes (bytes 1480-2959). Offset 1480/8 = 185. MF=1. Total Length = 1500.
    Remaining payload = 4480 - 1480 - 1480 = 1520 bytes.
    Fragment 3 data: 1480 bytes (bytes 2960-4439). Offset 2960/8 = 370. MF=1. Total Length = 1500.
    Remaining payload = 1520 - 1480 = 40 bytes.
    Fragment 4 data: 40 bytes (bytes 4440-4479). Offset 4440/8 = 555. MF=0. Total Length = 60.

- **Knowledge Point:** IPv4 Fragmentation process; IPv4 Header fields: Total Length, Identification, Flags (DF, MF), Fragment Offset; MTU constraints; Calculation of fragment sizes and offsets. Reassembly at the destination.

---

## Question 3: IP Addressing and Subnetting

A small company has been assigned the Class C network address `203.0.113.0`.

a)  What is the default subnet mask for this Class C network?

- **Answer**: The default subnet mask for a Class C network is `255.255.255.0`.
- **Knowledge Point**: Classful IP addressing (Class C); Default subnet masks.

b)  How many unique host IP addresses can be assigned to devices within this network using the default subnet mask? Explain your calculation.

- **Answer**: A Class C network address with a default subnet mask of `255.255.255.0` uses the first 24 bits for the network portion and the last 8 bits for the host portion.
Number of bits for hosts = 8 bits.
Total possible addresses in the host portion = $2^8 =256$.
However, two addresses are reserved:
1.  The address with all host bits as 0 (e.g., `203.0.113.0`) is the network address itself.
2.  The address with all host bits as 1 (e.g., `203.0.113.255`) is the broadcast address for that network.
Therefore, the number of unique (usable) host IP addresses is $2^8 −2=256−2=254$.
- **Knowledge Point**: Calculating usable host addresses in a network ($2^n −2$, where n is the number of host bits); Reserved addresses (network address, broadcast address).

c)  The company decides it needs to create at least 3 separate subnets for different departments. Suggest a suitable subnet mask that would allow for this. How many usable host IP addresses would be available per subnet with your suggested mask?

- **Answer**: To create at least 3 subnets, we need to borrow bits from the host portion of the Class C address.
If we borrow 1 bit, we get $2^1 =2$ subnets (not enough).
If we borrow 2 bits, we get $2^2 =4$ subnets (this is sufficient).
Original host bits = 8. Borrowing 2 bits leaves `8−2=6` bits for hosts per subnet.
The new subnet mask would have 2 additional bits set to 1 in the last octet compared to the default.
Default mask (binary last octet): `00000000`
New mask (binary last octet, borrowing 2 bits): `11000000`
This corresponds to `128+64=192` in decimal.
So, the new subnet mask is `255.255.255.192`.

    Number of usable host IP addresses per subnet:
    Host bits per subnet = 6.
    Total addresses per subnet = $2^6 = 64$.
    Usable host addresses per subnet = $2^6 - 2 = 64 - 2 = \textbf{62}$.

- **Knowledge Point**: Subnetting; Borrowing host bits for subnetting; Calculating the number of subnets ($2^s$, where s is borrowed bits); Calculating new subnet mask; Calculating usable hosts per subnet.

---

## Question 4: IP Forwarding

A router, R1, has the following entries (simplified) in its forwarding table:

| Destination Network | Next Hop | Interface |
|---------------------|----------|-----------|
| 192.168.1.0/24      | -        | Eth0      |
| 192.168.2.0/24      | 10.0.0.2 | Eth1      |
| 0.0.0.0/0           | 203.0.113.1 | Eth2      |

R1 receives an IP packet destined for `192.168.2.15`.

a)  Explain the process R1 uses to decide where to send this packet. Which entry in the table will be matched, and what will R1 do with the packet?

- **Answer**: R1 will compare the destination IP address (`192.168.2.15`) with the "Destination Network" entries in its forwarding table using a longest prefix match.
1.  Check `192.168.1.0/24`: `192.168.2.15` does not fall within the `192.168.1.0` network. No match.
2.  Check `192.168.2.0/24`: `192.168.2.15` does fall within the `192.168.2.0` network (addresses from `192.168.2.0` to `192.168.2.255`). This is a match.
3.  The `0.0.0.0/0` is a default route and would only be used if no more specific match is found. Since `192.168.2.0/24` is more specific, it takes precedence.

    The entry **192.168.2.0/24** will be matched. R1 will send the packet to the "Next Hop" address **10.0.0.2** out of its **Eth1** interface.
- **Knowledge Point**: IP Forwarding process; Forwarding tables (routing tables); Longest prefix match rule; Next hop; Interface.

b)  What is the significance of the 0.0.0.0/0 entry in a forwarding table?

- **Answer**: The `0.0.0.0/0` entry represents the default route. It is used when an IP packet's destination address does not match any other more specific network entries in the forwarding table. Essentially, if the router doesn't have a specific route for a destination, it sends the packet to the next-hop router specified by the default route, hoping that router will know how to get it closer to its destination or also has a default route. It is crucial for enabling communication with networks not explicitly listed in the router's table (e.g., the broader internet).
- **Knowledge Point**: Default route (`0.0.0.0/0`); Purpose in forwarding.

---

## Question 5: DHCP

A student brings their new laptop to the university library and connects it to the wired Ethernet network.

a)  Briefly describe the four main steps (the DORA process) the laptop will typically use to automatically obtain an IP address via DHCP.

- **Answer**: The four main steps are:
1.  **Discover**: The laptop (DHCP client) broadcasts a "DHCP Discover" message on the local network to find any available DHCP servers.
2.  **Offer**: DHCP server(s) that receive the discover message may respond by broadcasting a "DHCP Offer" message, offering an IP address and other configuration parameters (e.g., lease time).
3.  **Request**: The laptop selects one of the offers (usually the first one it receives) and broadcasts a "DHCP Request" message, requesting the offered IP address from the chosen server. This message also implicitly declines offers from other servers.
4.  **Acknowledge (Ack)**: The selected DHCP server responds with a "DHCP Acknowledge" message, confirming the IP address lease and providing other configuration details (like subnet mask, default gateway, DNS server). The client can now use the assigned IP address.
- **Knowledge Point**: DHCP (Dynamic Host Configuration Protocol); DORA process (Discover, Offer, Request, Acknowledge); Client-server interaction in DHCP.

b)  Besides an IP address, list two other essential pieces of network configuration information that the DHCP server is likely to provide to the laptop.

- **Answer**: Two other essential pieces of network configuration information are:
1.  **Subnet Mask**: To define the local network range.
2.  **Default Gateway (Router) IP Address**: To allow the laptop to communicate with devices outside its local subnet.
(Another common one is DNS Server IP Address)
- **Knowledge Point**: Information provided by DHCP (IP address, subnet mask, default gateway, DNS server, lease time).

---

## Question 6: General Network Layer Concepts

a)  The Internet Protocol (IP) is described as offering a "best-effort" delivery service. Explain what this means.

- **Answer**: "Best-effort" delivery means that IP does not provide any guarantees that data will actually be delivered to the destination. It will make an "effort" to deliver packets, but:
* Packets may be lost (e.g., due to network congestion or errors).
* Packets may arrive out of order.
* Packets may be duplicated.
* Packets may be delayed by an arbitrary amount of time.
IP does not include mechanisms for error recovery (e.g., retransmitting lost packets) or flow control. These reliability functions are typically handled by higher-layer protocols like TCP.
- **Knowledge Point**: IP service model (connectionless, unreliable, best-effort); Implications of best-effort service.

b)  What is the primary difference in responsibility between the Network Layer and the Data Link Layer regarding packet delivery?

- **Answer**:
- **Data Link Layer**: Responsible for transferring frames of data between two directly connected nodes (i.e., across a single link or hop in the network). It deals with issues like physical addressing (MAC addresses), framing, error detection on that specific link, and media access control.
- **Network Layer**: Responsible for end-to-end delivery of packets from the original source host to the final destination host, potentially across multiple interconnected networks (hops). It deals with logical addressing (IP addresses), determining paths (forwarding decisions based on routing information, though detailed routing algorithms are out of scope for this exam), and fragmentation if necessary.
In essence, the Data Link Layer handles hop-to-hop delivery, while the Network Layer handles source-to-destination delivery.
- **Knowledge Point**: OSI model layer responsibilities; Network Layer (end-to-end, logical addressing, multi-hop) vs. Data Link Layer (hop-to-hop, physical addressing, single link).

---

# Network Layer Open Book Notes

## 1. Network Layer Introduction & Responsibilities

**Primary Role**: Responsible for getting packets from the source host to the destination host, possibly across multiple networks (hops). This is end-to-end transmission at the lowest OSI layer that deals with it.

**Key Functions (Examinable Focus)**:

- **Logical Addressing (IP Addressing)**: Assigning unique IP addresses to devices for identification on the network.
- **Forwarding**: The local action by a router of moving a packet from an input link to the appropriate output link. This involves consulting a forwarding table.
- **Fragmentation & Reassembly**: If a packet is larger than the Maximum Transmission Unit (MTU) of a network link, the Network Layer fragments it into smaller pieces. These are reassembled at the destination.

**Service Model of IP**:

- **Connectionless**: No connection is established before sending data. Each packet is handled independently. Like sending a letter.
- **Best-Effort Delivery**: IP makes its best effort to deliver packets, but there are no guarantees.
    - Packets may be lost.
    - Packets may arrive out of order.
    - Packets may be duplicated.
    - Packets may be delayed.
- **Unreliable**: IP itself does not perform error recovery (e.g., retransmission of lost packets) or flow control. These are typically handled by upper-layer protocols (e.g., TCP).

---

## 2. Internet Protocol (IP) - General

- The main network layer protocol in the TCP/IP suite.
- Handles addressing and forwarding.
- IPv4 is the version primarily focused on for examinable topics (excluding IPv6).

---

## 3. IPv4 Packet Header

The IPv4 header contains information for delivering the packet. Standard header is 20 bytes long (without options).

| Field Name         | Size (bits) | Description |
|--------------------|-------------|-------------|
| Version             | 4           | Indicates the IP version (e.g., 4 for IPv4). |
| Header Length (IHL) | 4           | Length of the IP header in 32-bit words. Minimum value is 5 (for a 20-byte header). If options are present, this value will be greater than 5. |
| Type of Service (TOS) | 8         | (Generally not a deep focus in exams based on provided material, but good to know it exists for QoS hints). |
| Total Length        | 16          | Total length of the IP datagram (header + data) in bytes. Max size 65,535 bytes. |
| Identification      | 16          | Unique ID for a group of fragments belonging to a single original IP datagram. Used in reassembly. |
| Flags               | 3           | - Bit 0: Reserved (must be 0).<br>- Bit 1: DF (Don't Fragment): If 1, packet cannot be fragmented. If fragmentation is needed but DF=1, packet is dropped, and an ICMP error is sent.<br>- Bit 2: MF (More Fragments): If 1, this is not the last fragment. If 0, this is the last fragment or the only fragment. |
| Fragment Offset     | 13          | Specifies the offset of this fragment's data relative to the start of the original datagram's data, measured in 8-byte units. Used in reassembly. |
| Time To Live (TTL) | 8           | Decremented by each router that forwards the packet. If TTL reaches 0, the packet is discarded (prevents indefinite loops). Originally seconds, now effectively hop count. |
| Protocol            | 8           | Indicates the protocol of the data payload being carried (e.g., TCP=6, UDP=17, ICMP=1). Used for demultiplexing at the destination. |
| Header Checksum     | 16          | An error-checking checksum calculated only over the IP header. Recalculated by each router because the TTL field (and potentially options) changes. |
| Source IP Address   | 32          | The IPv4 address of the original sender. |
| Destination IP Address | 32        | The IPv4 address of the final recipient. |
| Options             | variable    | Used for various control functions like source routing, record route, timestamping. (Not a deep focus, but know they can exist and affect header length). |
| Padding             | variable    | Used to ensure the IP header ends on a 32-bit boundary if options are present and don't fill it. |

**IPv4 Header 主要字段**：


**字段说明**：
- **Version**：4 位，IP 版本号（如 IPv4 为 4）
- **IHL**：4 位，首部长度（以 32 位字为单位）
- **TOS**：8 位，服务类型
- **Total Length**：16 位，报文总长度（字节）
- **Identification**：16 位，分片标识
- **Flags**：3 位，分片标志（DF/MF）
- **Fragment Offset**：13 位，分片偏移
- **TTL**：8 位，生存时间
- **Protocol**：8 位，上层协议号（如 TCP=6, UDP=17, ICMP=1）
- **Header Checksum**：16 位，首部校验和
- **Source IP Address**：32 位，源 IP 地址
- **Destination IP Address**：32 位，目的 IP 地址
- **Options + Padding**：可选字段和填充

---

## 4. IP Fragmentation

- **MTU (Maximum Transmission Unit)**: The largest packet size (in bytes) that a particular link-layer technology can carry in a single frame.

- **When Fragmentation Occurs**: If an IP datagram is larger than the MTU of an outgoing link, the router must fragment the datagram.

- **Process**:
    - The original datagram is split into multiple smaller IP datagrams (fragments).
    - Each fragment gets its own IP header, largely copied from the original.
    - **Identification field**: Copied from the original datagram to all fragments, so the destination knows they belong together.
    - **Total Length field**: Set to the size of the individual fragment.
    - **MF (More Fragments) flag**: Set to `1` for all fragments except the last one (which has MF=0).
    - **Fragment Offset field**: Indicates where in the original datagram's data this fragment belongs. Calculated in 8-byte blocks. The first fragment has an offset of 0.

The **DF (Don't Fragment)** flag in the original packet can prevent fragmentation. If DF=1 and fragmentation is needed, the packet is dropped.

**Reassembly**: Performed only at the final destination host, using the Identification and Fragment Offset fields. Lost fragments are not recovered by IP; this is the responsibility of higher layers (like TCP).

---

## 5. IPv4 Addressing

- **Structure**: A 32-bit logical address, typically written in dotted-decimal notation (e.g., `192.168.1.1`). Each decimal number represents 8 bits (an octet).

- **Parts**: An IP address is divided into a Network ID and a Host ID.

**Classful Addressing (Legacy, but provides context for default masks)**:

- **Class A**:
    - Starts with `0` (binary). Range: `1.x.x.x` to `126.x.x.x`. (`0.x.x.x` and `127.x.x.x` are special).
    - Default Mask: `255.0.0.0` (`/8`).
    - Network ID: First 8 bits. Host ID: Last 24 bits.
    - Few networks, many hosts per network.

- **Class B**:
    - Starts with `10` (binary). Range: `128.0.x.x` to `191.255.x.x`.
    - Default Mask: `255.255.0.0` (`/16`).
    - Network ID: First 16 bits. Host ID: Last 16 bits.
    - Moderate number of networks and hosts.

- **Class C**:
    - Starts with `110` (binary). Range: `192.0.0.x` to `223.255.255.x`.
    - Default Mask: `255.255.255.0` (`/24`).
    - Network ID: First 24 bits. Host ID: Last 8 bits.
    - Many networks, few hosts per network.

(Class D - Multicast, Class E - Experimental: Not typically focused on for basic addressing).

## Reserved Addresses within a Network/Subnet

- **Network Address**: Host ID portion is all zeros (e.g., `192.168.1.0` for network `192.168.1.0/24`). Identifies the network itself. **Cannot be assigned to a host.**
- **Broadcast Address**: Host ID portion is all ones (e.g., `192.168.1.255` for network `192.168.1.0/24`). Sends a packet to all hosts on that specific network. **Cannot be assigned to a host.**
- **Number of Usable Hosts**: For $h$ host bits, $2^h - 2$ usable host addresses.

---

## 6. Subnetting

**Purpose**: Divides a single large network (e.g., a Class A, B, or C network) into multiple smaller, interconnected networks called **subnets**.

- Improves organization and security
- Reduces network traffic by localizing broadcasts

**Subnet Mask**: A 32-bit value that distinguishes the network/subnet portion of an IP address from the host portion.

- Bits set to `1` in the mask correspond to the network/subnet portion.
- Bits set to `0` in the mask correspond to the host portion.

**How it Works**: "Borrows" bits from the original host portion to create a **Subnet ID** field.

**IP Address Structure with Subnetting**:

```
[Original Network ID] [Subnet ID] [Host ID]
```

- The subnet mask will have more `1`s than the default mask for that class.

**Example (Class C)**:

- Network: `200.10.20.0` (default mask `255.255.255.0` or `/24`)

---

## 7. IP Forwarding

- **Routers**: Devices that operate at the Network Layer. They connect different networks and make decisions about where to send packets.

- **Forwarding Table (often called Routing Table in practice)**: Each router maintains a table that maps destination network prefixes to:
    - **Next Hop**: The IP address of the next router to send the packet to.
    - **Interface**: The outgoing network interface on the current router to use to send the packet.

If the destination network is directly connected, the Next Hop might be empty or indicate direct delivery, and the Interface points to that local network.

**Forwarding Process (Simplified)**:

1. Router receives an IP packet.
2. Router extracts the destination IP address from the packet header.
3. Router consults its forwarding table.
4. **Longest Prefix Match**: The router finds the entry in the table whose network prefix matches the longest portion of the destination IP address. This is the most specific route.
    - **Example**: If table has `192.168.0.0/16` and `192.168.1.0/24`, a packet to `192.168.1.50` will match `192.168.1.0/24` (more specific).
5. Once a match is found, the router sends the packet to the Next Hop address via the specified Interface.
6. If TTL is decremented, the header checksum is recomputed.

**Default Route (`0.0.0.0/0` or `0.0.0.0` with mask `0.0.0.0`)**:

- A special entry in the forwarding table.
- Used if no other more specific match is found for the destination IP address.
- Typically points to an upstream router that has more extensive network knowledge (e.g., an ISP router). Essential for reaching the broader internet.

---

## 8. DHCP (Dynamic Host Configuration Protocol)

**Purpose**: Allows hosts to automatically obtain an IP address and other network configuration parameters when they join a network, instead of requiring manual configuration.

**Client-Server Model**: DHCP client (the host) requests configuration from a DHCP server.

**DORA Process (4 main steps)**:

1. **Discover**:
    - Client broadcasts a `DHCPDISCOVER` message on the local network.
    - Source IP: `0.0.0.0` (since it doesn't have one yet).
    - Destination IP: `255.255.255.255` (broadcast).
2. **Offer**:
    - DHCP server(s) receiving the discover message may reply with a `DHCPOFFER` message.
    - This message contains a proposed IP address and other parameters (e.g., lease duration).
    - Usually sent as a broadcast (or unicast if server knows client's MAC from discover).
3. **Request**:
    - Client chooses one offer (e.g., the first one it receives) and broadcasts a `DHCPREQUEST` message.
    - This message indicates the chosen server and the requested IP address.
    - This implicitly tells other offering servers that their offers were not accepted.
4. **Acknowledge (ACK)**:
    - The selected DHCP server responds with a `DHCPACK` message.
    - This confirms the IP address lease and provides the final configuration parameters.
    - The client can now use the assigned IP address.

**Information Provided by DHCP Server (besides IP address)**:

- Subnet Mask
- Default Gateway (Router) IP Address
- DNS Server IP Address(es)
- Lease Duration: How long the client can use the IP address before needing to renew.
- DHCP Relay Agent: If client and server are on different subnets, a router can be configured as a DHCP relay agent to forward DHCP messages between them.

---

## Key Reminder for Open Book:

- Understand the concepts and how they interrelate.
- Be able to apply them to scenarios (like fragmentation calculations, subnetting design).
- Quickly locate relevant header field descriptions.